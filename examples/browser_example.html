<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CogniServe Per-Agent Streaming Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2563eb;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }
        
        select, textarea, button {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        select:focus, textarea:focus {
            outline: none;
            border-color: #2563eb;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }
        
        button {
            background: #2563eb;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        
        button:hover:not(:disabled) {
            background: #1d4ed8;
        }
        
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .mode-toggle button {
            flex: 1;
            background: #f3f4f6;
            color: #374151;
        }
        
        .mode-toggle button.active {
            background: #2563eb;
            color: white;
        }
        
        .response-container {
            margin-top: 30px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            min-height: 200px;
            background: #fafafa;
        }
        
        .response-header {
            background: #f3f4f6;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            color: #374151;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-indicator {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-ready { background: #d1fae5; color: #065f46; }
        .status-streaming { background: #fef3c7; color: #92400e; }
        .status-complete { background: #dbeafe; color: #1e40af; }
        .status-error { background: #fee2e2; color: #dc2626; }
        
        .response-content {
            padding: 16px;
            white-space: pre-wrap;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 14px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .agent-info {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .agent-info h3 {
            margin: 0 0 8px 0;
            color: #0c4a6e;
        }
        
        .agent-info p {
            margin: 0;
            color: #0369a1;
            font-size: 14px;
        }
        
        .example-prompts {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .example-prompt {
            background: #e0e7ff;
            color: #3730a3;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s;
        }
        
        .example-prompt:hover {
            background: #c7d2fe;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .mode-toggle {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 CogniServe</h1>
        <p class="subtitle">Per-Agent Streaming API Demo</p>
        
        <div class="form-group">
            <label for="agent-select">Select Agent:</label>
            <select id="agent-select">
                <option value="assistant">General Assistant - Helpful AI for general questions</option>
                <option value="coder">Coding Assistant - Programming and development help</option>
                <option value="research">Research Assistant - Multi-agent research system</option>
            </select>
        </div>
        
        <div id="agent-info" class="agent-info">
            <h3>General Assistant</h3>
            <p>A helpful AI assistant for answering questions and providing information on various topics.</p>
        </div>
        
        <div class="form-group">
            <label for="message-input">Your Message:</label>
            <div class="example-prompts" id="example-prompts">
                <button class="example-prompt" onclick="setExamplePrompt('Tell me a joke')">Tell me a joke</button>
                <button class="example-prompt" onclick="setExamplePrompt('Explain quantum computing')">Explain quantum computing</button>
                <button class="example-prompt" onclick="setExamplePrompt('What is the meaning of life?')">Meaning of life</button>
            </div>
            <textarea id="message-input" placeholder="Type your message here...">Hello! Can you tell me a short joke?</textarea>
        </div>
        
        <div class="mode-toggle">
            <button id="stream-btn" class="active" onclick="setMode('stream')">🌊 Stream Response</button>
            <button id="sync-btn" onclick="setMode('sync')">⚡ Get Full Response</button>
        </div>
        
        <div class="form-group">
            <button id="send-btn" onclick="sendMessage()">Send Message</button>
        </div>
        
        <div class="response-container">
            <div class="response-header">
                <span>Response</span>
                <span id="status" class="status-indicator status-ready">Ready</span>
            </div>
            <div id="response" class="response-content">Click "Send Message" to start...</div>
        </div>
    </div>

    <script>
        let currentMode = 'stream';
        let eventSource = null;
        
        const agentInfo = {
            assistant: {
                name: "General Assistant",
                description: "A helpful AI assistant for answering questions and providing information on various topics.",
                examples: [
                    "Tell me a joke",
                    "Explain quantum computing", 
                    "What is the meaning of life?",
                    "Help me plan a vacation"
                ]
            },
            coder: {
                name: "Coding Assistant", 
                description: "Expert programming assistant for coding questions, debugging, and best practices.",
                examples: [
                    "How to sort a list in Python?",
                    "Explain async/await in JavaScript",
                    "Best practices for REST APIs",
                    "Debug this SQL query"
                ]
            },
            research: {
                name: "Research Assistant",
                description: "Multi-agent research system with web search capabilities for comprehensive research.",
                examples: [
                    "Research climate change impacts",
                    "Latest AI developments 2024",
                    "Compare renewable energy sources",
                    "Analyze market trends"
                ]
            }
        };
        
        function updateAgentInfo() {
            const selectedAgent = document.getElementById('agent-select').value;
            const info = agentInfo[selectedAgent];
            
            document.getElementById('agent-info').innerHTML = `
                <h3>${info.name}</h3>
                <p>${info.description}</p>
            `;
            
            // Update example prompts
            const exampleContainer = document.getElementById('example-prompts');
            exampleContainer.innerHTML = info.examples.map(example => 
                `<button class="example-prompt" onclick="setExamplePrompt('${example}')">${example}</button>`
            ).join('');
        }
        
        function setExamplePrompt(prompt) {
            document.getElementById('message-input').value = prompt;
        }
        
        function setMode(mode) {
            currentMode = mode;
            document.getElementById('stream-btn').classList.toggle('active', mode === 'stream');
            document.getElementById('sync-btn').classList.toggle('active', mode === 'sync');
        }
        
        function updateStatus(status, text) {
            const statusEl = document.getElementById('status');
            statusEl.className = `status-indicator status-${status}`;
            statusEl.textContent = text;
        }
        
        async function sendMessage() {
            const agent = document.getElementById('agent-select').value;
            const message = document.getElementById('message-input').value.trim();
            
            if (!message) {
                alert('Please enter a message');
                return;
            }
            
            const sendBtn = document.getElementById('send-btn');
            const responseEl = document.getElementById('response');
            
            // Disable send button and clear response
            sendBtn.disabled = true;
            responseEl.textContent = '';
            
            try {
                if (currentMode === 'stream') {
                    await streamResponse(agent, message);
                } else {
                    await syncResponse(agent, message);
                }
            } catch (error) {
                updateStatus('error', 'Error');
                responseEl.textContent = `❌ Error: ${error.message}`;
            } finally {
                sendBtn.disabled = false;
            }
        }
        
        async function streamResponse(agent, message) {
            updateStatus('streaming', 'Streaming...');
            
            const response = await fetch(`http://localhost:8000/${agent}/stream`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'text/event-stream'
                },
                body: JSON.stringify({
                    message: message,
                    max_turns: 5
                })
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            const responseEl = document.getElementById('response');
            
            try {
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            try {
                                const event = JSON.parse(line.slice(6));
                                handleStreamEvent(event, responseEl);
                            } catch (e) {
                                console.warn('Failed to parse event:', line);
                            }
                        }
                    }
                }
                
                updateStatus('complete', 'Complete');
            } catch (error) {
                updateStatus('error', 'Error');
                throw error;
            }
        }
        
        async function syncResponse(agent, message) {
            updateStatus('streaming', 'Processing...');
            
            const response = await fetch(`http://localhost:8000/${agent}/run`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: message,
                    max_turns: 5
                })
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const result = await response.json();
            const responseEl = document.getElementById('response');
            
            if (result.success) {
                responseEl.textContent = `✅ ${result.final_output}`;
                updateStatus('complete', 'Complete');
            } else {
                responseEl.textContent = `❌ Error: ${result.error}`;
                updateStatus('error', 'Error');
            }
        }
        
        function handleStreamEvent(event, responseEl) {
            const eventType = event.type;
            const data = event.data;
            const agent = event.agent;
            
            if (eventType === 'raw_response_event') {
                // Token-by-token streaming
                if (data && data.delta) {
                    responseEl.textContent += data.delta;
                    responseEl.scrollTop = responseEl.scrollHeight;
                }
            } else if (eventType === 'run_item_stream_event') {
                // High-level events
                if (data.type && data.type.includes('message')) {
                    if (data.content && Array.isArray(data.content)) {
                        for (const item of data.content) {
                            if (item.type === 'text') {
                                responseEl.textContent += `\n🤖 ${agent}: ${item.text}\n`;
                            }
                        }
                    }
                }
                responseEl.scrollTop = responseEl.scrollHeight;
            } else if (eventType === 'completion') {
                responseEl.textContent += `\n\n✅ ${agent} completed: ${data.final_output}`;
                responseEl.scrollTop = responseEl.scrollHeight;
            } else if (eventType === 'error') {
                responseEl.textContent += `\n\n❌ ${agent} error: ${data.error}`;
                responseEl.scrollTop = responseEl.scrollHeight;
            }
        }
        
        // Initialize
        document.getElementById('agent-select').addEventListener('change', updateAgentInfo);
        updateAgentInfo();
        
        // Handle Enter key in textarea
        document.getElementById('message-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                sendMessage();
            }
        });
    </script>
</body>
</html> 